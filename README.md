# Daoutech Custom Plugin

다우기술 레드마인 환경을 위한 통합 커스텀 플러그인입니다. 초기화면 대시보드 시각화, 일감 상세 페이지 확장, 프로젝트별 필수 항목 관리, Git 웹훅 연동 등의 기능을 제공하여 협업 효율성을 높입니다.

## 주요 기능

### 1. 프로젝트별 이슈 현황 대시보드
- **시각화**: 레드마인 접속 시 첫 화면(Welcome index)에 프로젝트별 이슈 처리 현황을 Pie Chart로 제공합니다.
- **기간 필터링**: 시작일과 종료일을 설정하여 특정 기간(최대 365일) 동안 생성된 일감의 현황을 조회할 수 있습니다.
- **빠른 이동**: 차트의 각 상태 영역을 클릭하면 해당 프로젝트의 필터링된 이슈 목록으로 즉시 이동합니다.
- **Chart.js v4**: 최신 Chart.js 라이브러리를 내장하여 깔끔하고 반응성 있는 차트를 제공합니다.

### 2. 일감 상세 페이지 확장
- 일감 상세 페이지(`issues/show`) 하단에 주요 타임스탬프 정보를 명확하게 표시합니다:
    - **등록자**: 일감을 생성한 사용자
    - **생성일**: 최초 생성 일시
    - **변경일**: 마지막 수정 일시
    - **종료일**: 일감이 완료 상태로 변경된 일시

### 3. 프로젝트별 필수 항목 설정 (강화됨)
- 기존의 단순 필수값 강제 방식을 개선하여, **프로젝트 설정 탭**에서 필수 항목을 유연하게 관리할 수 있습니다.
- **관리 가능한 필드**:
    - 기본 필드 (담당자, 범주 등)
    - 커스텀 필드 (사용자 정의 항목)
- 설정된 필드는 해당 프로젝트 내에서 일감 생성/수정 시 입력을 강제합니다.

### 4. Git 웹훅 연동 및 이력 추적
- **웹훅 수신**: Bitbucket 등 외부 Git 저장소의 웹훅을 수신합니다. (`/git_webhooks`)
- **이벤트 처리**:
    - `repo:refs_changed` (Push)
    - `pr:opened`, `pr:merged`, `pr:declined`, `pr:deleted` (Pull Request)
- **이력 저장**: 수신된 Git 활동 이력을 레드마인 데이터베이스에 저장하여 일감과 연계할 수 있는 기반을 제공합니다.

### 5. 사용자 경험(UX) 개선
- **프로젝트 링크**: 프로젝트 이름 클릭 시 '개요' 페이지 대신 실무 중심의 **'이슈 목록'** 페이지로 바로 이동합니다.
- **커스텀 스타일**: 플러그인 전용 CSS를 통해 가독성 높은 대시보드와 UI를 제공합니다.

## 환경구성 (테스트 완료 환경)

본 플러그인은 아래 환경에서 개발 및 테스트되었습니다.

- **OS**: Windows (Docker Desktop)
- **Docker Compose**: 2.40.3
- **Redmine**: 6.0.6
- **Ruby**: 3.3.9
- **Puma**: 7.0.1
- **Rails**: 7.2.2.1

## 설치 방법

1. **플러그인 다운로드**
   레드마인의 `plugins` 디렉토리로 이동하여 저장소를 복제합니다. (폴더명은 반드시 `daou_custom`이어야 합니다.)
   ```bash
   cd plugins
   git clone [repository_url] daou_custom
   ```

2. **의존성 설치**
   레드마인 루트 디렉토리에서 번들러를 실행합니다.
   ```bash
   bundle install
   ```

3. **데이터베이스 마이그레이션 (필수)**
   플러그인 전용 테이블(`git_histories`, `project_required_fields`)을 생성합니다.
   ```bash
   bundle exec rake redmine:plugins:migrate NAME=daou_custom RAILS_ENV=production
   ```

4. **서버 재시작**
   변경 사항 적용을 위해 레드마인 서버를 재시작합니다.

## 삭제 방법

1. **데이터베이스 롤백**
   플러그인 제거 전, 생성된 테이블을 삭제하기 위해 마이그레이션을 롤백합니다.
   ```bash
   bundle exec rake redmine:plugins:migrate NAME=daou_custom VERSION=0 RAILS_ENV=production
   ```

2. **디렉토리 삭제**
   플러그인 디렉토리를 제거합니다.
   ```bash
   rm -rf plugins/daou_custom
   ```

3. **서버 재시작**
   서버를 재시작하여 플러그인을 완전히 제거합니다.